#!/usr/bin/env bash

set -euo pipefail

source "$(dirname "$0")/../framework"

benchmark-start

main() {
  cd "$DOTF"

  install-prerequisits

  git submodule update --init --recursive
  update-pip
  dotf-pkgs install
  dotf-github install
  dotf-plugin nodejs git zsh nvim ripgrep tig bash tmux vifm lua

  if is_mac; then
    dotf-plugin osx-tuning iterm
  fi

  header 'npm install'
  npm install

  show-done
}

install-prerequisits() {
  if is_debian; then
    apt-fast-install unzip build-essential
  fi
}

update-pip() {
  if command_missing pip3; then
    if is_termux; then
      apt-fast-install python
    elif is_debian; then
      apt-fast-install python3 python3-pip
    elif is_mac; then
      brew_install python3
    else
      echo 'TODO: support installing pip3'
      exit 1
    fi
  fi

  pip3 install pip --upgrade --user
}

show-done() {
  echo -e "$GREEN=========================="
  echo "Done ($(benchmark-stop))"
  echo -e "==========================$RESET"
}

main "$@"
