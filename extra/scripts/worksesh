#!/usr/bin/env bash
#
# Usage: worksesh <minutes>

set -euo pipefail

if [ $# -eq 0 ]; then
  usage "$0"
  exit 1
fi

minutes="$1"
first=$((minutes - 2))

dotf-notify "Starting $minutes minute work session"

if [ "$first" -gt 0 ]; then
  echo "Sleeping for ${first} minutes..."
  sleep $((first * 60))
fi

if dotf-is-mac; then
  say "2 minutes remaining"
fi
dotf-notify "2 minutes remaining"
echo "Sleeping for 1 minute..."
sleep 60
if dotf-is-mac; then
  say "1 minute remaining"
fi
dotf-notify "1 minute remaining"
echo "Sleeping for 1 minute..."
sleep 60
dotf-notify "Locking in 5 seconds"
echo "Sleeping for 5 seconds..."
sleep 5

# TODO: support mac
if dotf-is-mac; then
  pmset displaysleepnow
else
  loginctl lock-session
fi
