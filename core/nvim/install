#!/usr/bin/env bash

set -euo pipefail

source "$DOTF/framework"

main() {
  if command_missing nvim; then
    if is_arm; then
      PRIMARY=yes "$DOTF/core/nvim/build"
    else
      echo "ERROR: The 'nvim' command is missing,"
      echo "       it was supposed to be installed by dotf-github"
    fi
  fi

  install-packer
  install-symlinks
  dotf-nvim-packer-sync
  "$DOTF/core/nvim/install-lua"

  (cd "$DOTF/core/nvim/ctags" && ./build)
}

install-symlinks() {
  mkdir -p ~/.config
  symlink "$DOTF/core/nvim" ~/.config/nvim

  symlink "$DOTF/core/nvim/pylintrc" ~/.pylintrc
  mkdir -p ~/.config/yamllint
  symlink "$DOTF/core/nvim/yamllint-config" ~/.config/yamllint/config
}

install-packer() {
  if [ ! -e ~/.local/share/nvim/site/pack/packer/start/packer.nvim ]; then
    dotf-bullet "Cloning packer..."
    git clone --depth 1 https://github.com/wbthomason/packer.nvim \
      ~/.local/share/nvim/site/pack/packer/start/packer.nvim
  fi
}

main "$@"
