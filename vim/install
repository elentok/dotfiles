#!/bin/bash

source `dirname $0`/../framework

main() {
  header "Vim"

  if [ "$OS" == "mac" ]; then
    install_on_mac
  else
    install_on_linux
  fi

  install_symlinks
  install_vim_plugins
  install_utils
  install_linters

  (cd $DOTF/vim && ./ctags-build)
}

install_on_mac() {
  brew_install macvim --with-cscope --override-system-vim --with-lua

  brew_install ctags
  brew_install the_silver_searcher # ag
}

install_on_linux() {
  if [ "$HAS_GUI" == "yes" ]; then
    apt_install vim-gnome
  else
    apt_install vim
  fi

  apt_install exuberant-ctags tidy
  brew_install the_silver_searcher # ag
  brew_install global --with-pygments
}

install_symlinks() {
  symlink "$DOTF/vim/init.vim" ~/.vimrc
  symlink "$DOTF/vim" ~/.vim
  symlink "$DOTF/vim/pylintrc" ~/.pylintrc
  symlink "$DOTF/vim/scss-lint.yml" ~/.scss-lint.yml
}

install_vim_plugins() {
  bullet "Running PlugInstall... "
  vim +PlugInstall +qall
  success "done"
}

install_utils() {
  npm_install vimspec
  npm_install marked
  npm_install name-that-color
  npm_install livedown
  pip_install powerline-status
}

install_linters() {
  npm_install coffeelint
  npm_install eslint
  npm_install jsonlint
  npm_install sass-lint
  pip_install pylint
  pip_install yamllint
  gem_install scss_lint
  gem_install haml_lint
}

main $@
